<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>从零开始搭建React项目 | 薛定猫的……饿!</title>
    <meta name="generator" content="VuePress 1.5.0">
    <link rel="icon" href="/favicon.ico">
    <link rel="manifest" href="/manifest.json">
    <link rel="apple-touch-icon" href="/icons/icon-152x152.png">
    <link rel="mask-icon" href="/icons/safari-pinned-tab.svg" color="#3eaf7c">
    <meta name="description" content="Hello, My Friend!">
    <meta name="author" content="叶江怀">
    <meta name="keyword" content="Mr.Ye's blog">
    <meta name="theme-color" content="#3eaf7c">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="msapplication-TileImage" content="/icons/icon-72x72.png">
    <meta name="msapplication-TileColor" content="#000000">
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">
    <link rel="preload" href="/assets/css/0.styles.bb2274cf.css" as="style"><link rel="preload" href="/assets/js/app.7fe1ffb5.js" as="script"><link rel="preload" href="/assets/js/3.788743b5.js" as="script"><link rel="preload" href="/assets/js/1.29b2523c.js" as="script"><link rel="preload" href="/assets/js/72.126c91c0.js" as="script"><link rel="preload" href="/assets/js/14.37268bde.js" as="script"><link rel="prefetch" href="/assets/js/10.33e8fcae.js"><link rel="prefetch" href="/assets/js/11.58b0f855.js"><link rel="prefetch" href="/assets/js/12.d3d77849.js"><link rel="prefetch" href="/assets/js/13.da3b5997.js"><link rel="prefetch" href="/assets/js/15.366b6647.js"><link rel="prefetch" href="/assets/js/16.f6b1eeee.js"><link rel="prefetch" href="/assets/js/17.222b11e7.js"><link rel="prefetch" href="/assets/js/18.db7714f6.js"><link rel="prefetch" href="/assets/js/19.abccbbff.js"><link rel="prefetch" href="/assets/js/20.5a4e2a5d.js"><link rel="prefetch" href="/assets/js/21.db579749.js"><link rel="prefetch" href="/assets/js/22.6e5ca0f3.js"><link rel="prefetch" href="/assets/js/23.7c52708f.js"><link rel="prefetch" href="/assets/js/24.835ec374.js"><link rel="prefetch" href="/assets/js/25.70563461.js"><link rel="prefetch" href="/assets/js/26.1995e34c.js"><link rel="prefetch" href="/assets/js/27.7666d8db.js"><link rel="prefetch" href="/assets/js/28.b57e0511.js"><link rel="prefetch" href="/assets/js/29.fc21b11c.js"><link rel="prefetch" href="/assets/js/30.0a45186f.js"><link rel="prefetch" href="/assets/js/31.d2a230f4.js"><link rel="prefetch" href="/assets/js/32.2ab47593.js"><link rel="prefetch" href="/assets/js/33.e26ea18c.js"><link rel="prefetch" href="/assets/js/34.bc2f6ee5.js"><link rel="prefetch" href="/assets/js/35.b15a63ef.js"><link rel="prefetch" href="/assets/js/36.2579a938.js"><link rel="prefetch" href="/assets/js/37.80927296.js"><link rel="prefetch" href="/assets/js/38.5dd089f0.js"><link rel="prefetch" href="/assets/js/39.d1bf6b7c.js"><link rel="prefetch" href="/assets/js/4.d7a1e803.js"><link rel="prefetch" href="/assets/js/40.4baad75c.js"><link rel="prefetch" href="/assets/js/41.e8e5ba3c.js"><link rel="prefetch" href="/assets/js/42.4096bff8.js"><link rel="prefetch" href="/assets/js/43.bfae162b.js"><link rel="prefetch" href="/assets/js/44.231c106f.js"><link rel="prefetch" href="/assets/js/45.722fe00e.js"><link rel="prefetch" href="/assets/js/46.dbb87c4c.js"><link rel="prefetch" href="/assets/js/47.16206d7e.js"><link rel="prefetch" href="/assets/js/48.5f25d14c.js"><link rel="prefetch" href="/assets/js/49.ca5f1892.js"><link rel="prefetch" href="/assets/js/5.26ede9a1.js"><link rel="prefetch" href="/assets/js/50.ce3da0ea.js"><link rel="prefetch" href="/assets/js/51.212abfe1.js"><link rel="prefetch" href="/assets/js/52.9824f466.js"><link rel="prefetch" href="/assets/js/53.834d6860.js"><link rel="prefetch" href="/assets/js/54.1b0bc714.js"><link rel="prefetch" href="/assets/js/55.53342e5e.js"><link rel="prefetch" href="/assets/js/56.0b8fa9a4.js"><link rel="prefetch" href="/assets/js/57.b4beac92.js"><link rel="prefetch" href="/assets/js/58.0cc5679f.js"><link rel="prefetch" href="/assets/js/59.b049f1a2.js"><link rel="prefetch" href="/assets/js/6.595dc63e.js"><link rel="prefetch" href="/assets/js/60.f71c42e1.js"><link rel="prefetch" href="/assets/js/61.b791ae63.js"><link rel="prefetch" href="/assets/js/62.45adf481.js"><link rel="prefetch" href="/assets/js/63.f9b5a2c5.js"><link rel="prefetch" href="/assets/js/64.032d3992.js"><link rel="prefetch" href="/assets/js/65.3c66b2ae.js"><link rel="prefetch" href="/assets/js/66.d60e26e5.js"><link rel="prefetch" href="/assets/js/67.b29e161f.js"><link rel="prefetch" href="/assets/js/68.34683a43.js"><link rel="prefetch" href="/assets/js/69.c633f73f.js"><link rel="prefetch" href="/assets/js/7.de304bbe.js"><link rel="prefetch" href="/assets/js/70.b99ee51d.js"><link rel="prefetch" href="/assets/js/71.b8e16fe4.js"><link rel="prefetch" href="/assets/js/73.d11c2027.js"><link rel="prefetch" href="/assets/js/74.d905ea46.js"><link rel="prefetch" href="/assets/js/75.7aa16953.js"><link rel="prefetch" href="/assets/js/76.3babcf0c.js"><link rel="prefetch" href="/assets/js/77.123f8522.js"><link rel="prefetch" href="/assets/js/78.01eddb07.js"><link rel="prefetch" href="/assets/js/79.adfd6ccb.js"><link rel="prefetch" href="/assets/js/8.95a77bd0.js"><link rel="prefetch" href="/assets/js/80.3e5f5aec.js"><link rel="prefetch" href="/assets/js/81.de79470c.js"><link rel="prefetch" href="/assets/js/82.18020199.js"><link rel="prefetch" href="/assets/js/83.68d39dbc.js"><link rel="prefetch" href="/assets/js/9.6447d90b.js">
    <link rel="stylesheet" href="/assets/css/0.styles.bb2274cf.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container no-sidebar" data-v-dad8a512><div data-v-dad8a512><div id="loader-wrapper" class="loading-wrapper" data-v-d48f4d20 data-v-dad8a512 data-v-dad8a512><div class="loader-main" data-v-d48f4d20><div data-v-d48f4d20></div><div data-v-d48f4d20></div><div data-v-d48f4d20></div><div data-v-d48f4d20></div></div> <!----> <!----></div> <div class="password-shadow password-wrapper-out" style="display:none;" data-v-64685f0e data-v-dad8a512 data-v-dad8a512><h3 class="title" style="display:none;" data-v-64685f0e data-v-64685f0e>薛定猫的……饿!</h3> <!----> <label id="box" class="inputBox" style="display:none;" data-v-64685f0e data-v-64685f0e><input type="password" value="" data-v-64685f0e> <span data-v-64685f0e>Konck! Knock!</span> <button data-v-64685f0e>OK</button></label> <div class="footer" style="display:none;" data-v-64685f0e data-v-64685f0e><span data-v-64685f0e><i class="iconfont reco-theme" data-v-64685f0e></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-64685f0e>vuePress-theme-reco</a></span> <span data-v-64685f0e><i class="iconfont reco-copyright" data-v-64685f0e></i> <a data-v-64685f0e><span data-v-64685f0e>叶江怀</span>
            
          <span data-v-64685f0e>2020 - </span>
          2021
        </a></span></div></div> <div class="hide" data-v-dad8a512><header class="navbar" data-v-dad8a512><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/logo.png" alt="薛定猫的……饿!" class="logo"> <span class="site-name">薛定猫的……饿!</span></a> <div class="links"><div class="color-picker"><a class="color-button"><i class="iconfont reco-color"></i></a> <div class="color-picker-menu" style="display:none;"><div class="mode-options"><h4 class="title">Choose mode</h4> <ul class="color-mode-options"><li class="dark">dark</li><li class="auto active">auto</li><li class="light">light</li></ul></div></div></div> <div class="search-box"><i class="iconfont reco-search"></i> <input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link"><i class="iconfont undefined"></i>
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont undefined"></i>
      技术相关
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/css/" class="nav-link"><i class="iconfont undefined"></i>
  Css
</a></li><li class="dropdown-item"><!----> <a href="/categories/Javascript/" class="nav-link"><i class="iconfont undefined"></i>
  Javascript
</a></li><li class="dropdown-item"><!----> <a href="/categories/vue/" class="nav-link"><i class="iconfont undefined"></i>
  Vue
</a></li><li class="dropdown-item"><!----> <a href="/categories/react/" class="nav-link"><i class="iconfont undefined"></i>
  React
</a></li><li class="dropdown-item"><!----> <a href="/categories/node/" class="nav-link"><i class="iconfont undefined"></i>
  Node
</a></li><li class="dropdown-item"><!----> <a href="/categories/data_structure/" class="nav-link"><i class="iconfont undefined"></i>
  数据结构
</a></li><li class="dropdown-item"><!----> <a href="/categories/database/" class="nav-link"><i class="iconfont undefined"></i>
  数据库
</a></li><li class="dropdown-item"><!----> <a href="/categories/other/" class="nav-link"><i class="iconfont undefined"></i>
  其他
</a></li></ul></div></div><div class="nav-item"><a href="https://yejianghuai.github.io/nav/#/" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-category"></i>
  导航
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="/timeline/" class="nav-link"><i class="iconfont reco-date"></i>
  时间轴
</a></div><div class="nav-item"><a href="/docs/resume/" class="nav-link"><i class="iconfont undefined"></i>
  简历
</a></div><div class="nav-item"><a href="https://juejin.im/user/5c9c1b7d6fb9a070bd59b1bc/posts" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-juejin"></i>
  掘金
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://github.com/yejianghuai" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-github"></i>
  github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask" data-v-dad8a512></div> <aside class="sidebar" data-v-dad8a512><div class="personal-info-wrapper" data-v-ca798c94 data-v-dad8a512><img src="/avatar.png" alt="author-avatar" class="personal-img" data-v-ca798c94> <h3 class="name" data-v-ca798c94>
    叶江怀
  </h3> <div class="num" data-v-ca798c94><div data-v-ca798c94><h3 data-v-ca798c94>51</h3> <h6 data-v-ca798c94>Article</h6></div> <div data-v-ca798c94><h3 data-v-ca798c94>27</h3> <h6 data-v-ca798c94>Tag</h6></div></div> <hr data-v-ca798c94></div> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link"><i class="iconfont undefined"></i>
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont undefined"></i>
      技术相关
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/css/" class="nav-link"><i class="iconfont undefined"></i>
  Css
</a></li><li class="dropdown-item"><!----> <a href="/categories/Javascript/" class="nav-link"><i class="iconfont undefined"></i>
  Javascript
</a></li><li class="dropdown-item"><!----> <a href="/categories/vue/" class="nav-link"><i class="iconfont undefined"></i>
  Vue
</a></li><li class="dropdown-item"><!----> <a href="/categories/react/" class="nav-link"><i class="iconfont undefined"></i>
  React
</a></li><li class="dropdown-item"><!----> <a href="/categories/node/" class="nav-link"><i class="iconfont undefined"></i>
  Node
</a></li><li class="dropdown-item"><!----> <a href="/categories/data_structure/" class="nav-link"><i class="iconfont undefined"></i>
  数据结构
</a></li><li class="dropdown-item"><!----> <a href="/categories/database/" class="nav-link"><i class="iconfont undefined"></i>
  数据库
</a></li><li class="dropdown-item"><!----> <a href="/categories/other/" class="nav-link"><i class="iconfont undefined"></i>
  其他
</a></li></ul></div></div><div class="nav-item"><a href="https://yejianghuai.github.io/nav/#/" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-category"></i>
  导航
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="/timeline/" class="nav-link"><i class="iconfont reco-date"></i>
  时间轴
</a></div><div class="nav-item"><a href="/docs/resume/" class="nav-link"><i class="iconfont undefined"></i>
  简历
</a></div><div class="nav-item"><a href="https://juejin.im/user/5c9c1b7d6fb9a070bd59b1bc/posts" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-juejin"></i>
  掘金
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://github.com/yejianghuai" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-github"></i>
  github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav> <!----> </aside> <div class="password-shadow password-wrapper-in" style="display:none;" data-v-64685f0e data-v-dad8a512><h3 class="title" style="display:none;" data-v-64685f0e data-v-64685f0e>从零开始搭建React项目</h3> <!----> <label id="box" class="inputBox" style="display:none;" data-v-64685f0e data-v-64685f0e><input type="password" value="" data-v-64685f0e> <span data-v-64685f0e>Konck! Knock!</span> <button data-v-64685f0e>OK</button></label> <div class="footer" style="display:none;" data-v-64685f0e data-v-64685f0e><span data-v-64685f0e><i class="iconfont reco-theme" data-v-64685f0e></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-64685f0e>vuePress-theme-reco</a></span> <span data-v-64685f0e><i class="iconfont reco-copyright" data-v-64685f0e></i> <a data-v-64685f0e><span data-v-64685f0e>叶江怀</span>
            
          <span data-v-64685f0e>2020 - </span>
          2021
        </a></span></div></div> <div data-v-dad8a512><main class="page"><div class="page-title" style="display:none;"><h1>从零开始搭建React项目</h1> <hr> <div data-v-aa64b9d0><i class="iconfont reco-account" data-v-aa64b9d0><span data-v-aa64b9d0>叶江怀</span></i> <i class="iconfont reco-date" data-v-aa64b9d0><span data-v-aa64b9d0>2020-12-07</span></i> <!----> <i class="iconfont reco-tag tags" data-v-aa64b9d0><span class="tag-item" data-v-aa64b9d0>react</span></i></div></div> <div class="theme-reco-content content__default" style="display:none;"><div id="boxx" data-v-e16ac808><div data-v-e16ac808><p v-if="true" class="custom-block-title" data-v-e16ac808></p> <p v-if="true" data-v-e16ac808></p></div></div> <h1 id="从零开始搭建react项目"><a href="#从零开始搭建react项目" class="header-anchor">#</a> 从零开始搭建React项目</h1> <h2 id="_1-webpack基础概念"><a href="#_1-webpack基础概念" class="header-anchor">#</a> 1. Webpack基础概念</h2> <p>webpack主要作用：</p> <ul><li>代码转换：TypeScript 编译成 JavaScript、SCSS 编译成 CSS 等。</li> <li>文件优化：压缩 JavaScript、CSS、HTML 代码，压缩合并图片等。</li> <li>代码分割：提取多个页面的公共代码、提取首屏不需要执行部分的代码让其异步加载。</li> <li>模块合并：在采用模块化的项目里会有很多个模块和文件，需要构建功能把模块分类合并成一个文件。</li> <li>自动刷新：监听本地源代码的变化，自动重新构建、刷新浏览器。</li> <li>代码校验：在代码被提交到仓库前需要校验代码是否符合规范，以及单元测试是否通过。</li> <li>自动发布：更新完代码后，自动构建出线上发布代码并传输给发布系统。</li></ul> <p>Webpack 有以下几个核心概念：</p> <ul><li><strong>Entry</strong>：入口，Webpack 执行构建的第一步将从 Entry 开始，可抽象成输入。</li> <li><strong>Module</strong>：模块，在 Webpack 里一切皆模块，一个模块对应着一个文件。Webpack 会从配置的 Entry 开始递归找出所有依赖的模块。</li> <li><strong>Chunk</strong>：代码块，一个 Chunk 由多个模块组合而成，用于代码合并与分割。</li> <li><strong>Loader</strong>：模块转换器，用于把模块原内容按照需求转换成新内容。</li> <li><strong>Plugin</strong>：扩展插件，在 Webpack 构建流程中的特定时机会广播出对应的事件，插件可以监听这些事件的发生，在特定时机做对应的事情。</li> <li><strong>Output</strong>：输出结果，在 Webpack 经过一系列处理并得出最终想要的代码后输出结果。</li></ul> <p>构建过程：</p> <ol><li>从 Entry 里配置的 Module 开始递归解析 Entry 依赖的所有 Module。</li> <li>每找到一个 Module， 就会根据配置的 Loader 去找出对应的转换规则。</li> <li>对 Module 进行转换后，再解析出当前 Module 依赖的 Module。</li> <li>这些模块会以 Entry 为单位进行分组，一个 Entry 和其所有依赖的 Module 被分到一个组也就是一个 Chunk。</li> <li>最后 Webpack 会把所有 Chunk 转换成文件输出。</li> <li>在整个流程中 Webpack 会在恰当的时机执行 Plugin 里定义的逻辑。</li></ol> <h2 id="_2-项目需求"><a href="#_2-项目需求" class="header-anchor">#</a> 2. 项目需求</h2> <p>使用Webpack 4.x 搭建项目，满足以下需求：</p> <ol><li>使用ES6语言</li> <li>使用React框架</li> <li>自动生成HTML</li> <li>webpack-dev-server</li> <li>加载样式（CSS、SCSS）</li> <li>加载静态资源（图片、字体）</li> <li>使用第三方库</li> <li>其他（clean,merge,source map）</li></ol> <h2 id="_3-实战"><a href="#_3-实战" class="header-anchor">#</a> 3. 实战</h2> <h3 id="_3-1-基础环境"><a href="#_3-1-基础环境" class="header-anchor">#</a> 3.1 基础环境</h3> <p>NodeJS版本10.4.1。</p> <ol><li><p>初始化生成一个 <code>package.json</code> 文件。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>npm init <span class="token operator">-</span>y
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li><p>本地安装webpack</p> <p>webpack4版本命名行相关的功能独立到Webpack-cli。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>npm i webpack webpack<span class="token operator">-</span>cli <span class="token operator">-</span><span class="token constant">D</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li><p>新建webpack.config.js 配置文件。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>webpack默认会查找 webpack<span class="token punctuation">.</span>config<span class="token punctuation">.</span>js 作为配置文件。

自定义配置文件名称：
webpack <span class="token operator">--</span>config xx<span class="token punctuation">.</span>js
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div></li> <li><p>基础配置</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>webpack配置采用commonJS规范，通过module<span class="token punctuation">.</span>export导出一个描述如何构建的 Object 对象。

module<span class="token punctuation">.</span>exports<span class="token operator">=</span><span class="token punctuation">{</span>
    entry<span class="token operator">:</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>     <span class="token comment">//入口配置*</span>
    output<span class="token operator">:</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token comment">//出口配置*</span>
    modules<span class="token operator">:</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>   <span class="token comment">//module.rules loader</span>
    plugins<span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>   <span class="token comment">//插件</span>
    devServer<span class="token operator">:</span><span class="token punctuation">{</span><span class="token punctuation">}</span>   <span class="token comment">//开发服务器</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div></li></ol> <h3 id="_3-2-es6"><a href="#_3-2-es6" class="header-anchor">#</a> 3.2 ES6</h3> <h4 id="_3-2-1-前置步骤"><a href="#_3-2-1-前置步骤" class="header-anchor">#</a> 3.2.1 前置步骤</h4> <ol><li><p>按如下结构创建相应文件与目录：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>│  <span class="token keyword">package</span><span class="token punctuation">.</span>json
│  webpack<span class="token punctuation">.</span>config<span class="token punctuation">.</span>js
├─dist
│      index<span class="token punctuation">.</span>html      
└─src
        main<span class="token punctuation">.</span>js
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div></li> <li><p>main.js 内容：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">Ui</span> <span class="token punctuation">{</span>
    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span> age</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>age <span class="token operator">=</span> age<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token function">coding</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> is coding</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">let</span> ui<span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Ui</span><span class="token punctuation">(</span><span class="token string">'hqz'</span><span class="token punctuation">,</span><span class="token string">'18'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'app'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerText<span class="token operator">=</span>ui<span class="token punctuation">.</span><span class="token function">coding</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div></li> <li><p>index.html 内容：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token operator">&lt;</span>html<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>head<span class="token operator">&gt;</span>
	<span class="token operator">&lt;</span>meta charset<span class="token operator">=</span><span class="token string">&quot;UTF-8&quot;</span><span class="token operator">&gt;</span>
	<span class="token operator">&lt;</span>title<span class="token operator">&gt;</span><span class="token constant">ES6</span><span class="token operator">&lt;</span><span class="token operator">/</span>title<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>head<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>body<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>div id<span class="token operator">=</span><span class="token string">&quot;app&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>script src<span class="token operator">=</span><span class="token string">&quot;bundle.js&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>    <span class="token comment">//手动引入打包后的JS</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>body<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>html<span class="token operator">&gt;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div></li> <li><p>webpack配置</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> path<span class="token operator">=</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;path&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports<span class="token operator">=</span><span class="token punctuation">{</span>
    entry<span class="token operator">:</span><span class="token string">'./src/main.js'</span><span class="token punctuation">,</span>     <span class="token comment">//入口文件</span>
    output<span class="token operator">:</span><span class="token punctuation">{</span>                   <span class="token comment">//出口配置</span>
        filename<span class="token operator">:</span> <span class="token string">'bundle.js'</span><span class="token punctuation">,</span> <span class="token comment">//出口文件名</span>
        path<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'dist'</span><span class="token punctuation">)</span>  <span class="token comment">//出口文件路径</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    module<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token comment">//module.rules loader</span>
    plugins<span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>    <span class="token comment">//插件</span>
    devServer<span class="token operator">:</span><span class="token punctuation">{</span><span class="token punctuation">}</span>   <span class="token comment">//开发服务器</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div></li></ol> <h4 id="_3-2-2-配置babel"><a href="#_3-2-2-配置babel" class="header-anchor">#</a> 3.2.2 配置Babel</h4> <p>目前浏览器对ES6的标准支持不全，所以我们需要把ES6转换成ES5，包含以下两件事：</p> <ol><li>把新的 ES6 语法用 ES5 实现。</li> <li>给新的 API 注入 polyfill。</li></ol> <p>babel可以方便的完成以上2件事。 babel-preset-env的工作方式类似于babel-preset-latest，但它允许您指定环境并仅转换该环境中缺少的功能。</p> <p>babel 7.X的主要变更：</p> <ul><li>删除对未维护的 Node 版本的支持：0.10,0.12,2,5</li> <li>删除“Stage” &amp; 年度预设（preset-es2015 等）， 用@babel/preset-env 取代。</li> <li>对部分软件包进行重命名（e.g. babel-core--&gt;@babel/core）</li></ul> <p>简单升级：</p> <ol><li><p>利用babel-upgrade</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>npm i babel<span class="token operator">-</span>upgrade <span class="token operator">-</span>g
babel<span class="token operator">-</span>upgrade <span class="token operator">--</span>write
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></li> <li><p>重新安装包</p></li> <li><p>修改配置文件中的包名</p></li></ol> <p>配置：</p> <ol><li><p>本地安装Babel</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>npm i <span class="token operator">-</span><span class="token constant">D</span> @babel<span class="token operator">/</span>core @babel<span class="token operator">/</span>preset<span class="token operator">-</span>env babel<span class="token operator">-</span>loader
@babel<span class="token operator">/</span>plugin<span class="token operator">-</span>transform<span class="token operator">-</span>object<span class="token operator">-</span>rest<span class="token operator">-</span>spread @babel<span class="token operator">/</span>plugin<span class="token operator">-</span>transform<span class="token operator">-</span><span class="token keyword">export</span><span class="token operator">-</span>extensions @babel<span class="token operator">/</span>plugin<span class="token operator">-</span>transform<span class="token operator">-</span><span class="token keyword">class</span><span class="token operator">-</span>properties @babel<span class="token operator">/</span>plugin<span class="token operator">-</span>syntax<span class="token operator">-</span>dynamic<span class="token operator">-</span><span class="token keyword">import</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></li> <li><p>配置webpack</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>在module<span class="token punctuation">.</span>rules中添加如下：
module<span class="token operator">:</span> <span class="token punctuation">{</span>
        rules<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>
            test<span class="token operator">:</span> <span class="token regex">/\.js$/</span><span class="token punctuation">,</span>    <span class="token comment">//使用正则匹配所有需要使用babel-loader的文件</span>
            use<span class="token operator">:</span> <span class="token punctuation">{</span>
                loader<span class="token operator">:</span> <span class="token string">&quot;babel-loader&quot;</span><span class="token punctuation">,</span>  <span class="token comment">//指明要使用的loader</span>
                options<span class="token operator">:</span> <span class="token punctuation">{</span>               <span class="token comment">//传入loader的参数</span>
                    presets<span class="token operator">:</span> <span class="token punctuation">[</span>           <span class="token comment">//用于解析一组语法特性</span>
                        <span class="token punctuation">[</span>
                            <span class="token string">&quot;@babel/preset-env&quot;</span><span class="token punctuation">,</span>       <span class="token comment">//包含当前所有 ECMAScript 标准里的最新特性</span>
                            <span class="token punctuation">{</span>
                                <span class="token string">&quot;targets&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>   <span class="token comment">//指定需要兼容的浏览器类型和版本</span>
                                    <span class="token string">&quot;browsers&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
                                        <span class="token string">&quot;&gt; 1%&quot;</span><span class="token punctuation">,</span>     <span class="token comment">//支持市场份额超过1％的浏览器。</span>
                                        <span class="token string">&quot;ie &gt;= 9&quot;</span>   <span class="token comment">//支持IE9以上的版本</span>
                                    <span class="token punctuation">]</span>
                                <span class="token punctuation">}</span>
                            <span class="token punctuation">}</span>
                        <span class="token punctuation">]</span>
                    <span class="token punctuation">]</span><span class="token punctuation">,</span>
                    plugins<span class="token operator">:</span> <span class="token punctuation">[</span>         <span class="token comment">//用于解析某个语法特性</span>
                        <span class="token string">&quot;@babel/plugin-proposal-object-rest-spread&quot;</span><span class="token punctuation">,</span> <span class="token comment">//解析对象的扩展运算符（ES2018）</span>
                        <span class="token string">&quot;@babel/plugin-proposal-export-default-from&quot;</span><span class="token punctuation">,</span>  <span class="token comment">//解析额外的export语法:export v from &quot;xx/xx&quot;</span>
                        <span class="token string">&quot;@babel/plugin-proposal-export-namespace-from&quot;</span><span class="token punctuation">,</span> <span class="token comment">//解析额外的export语法:export v as vv from &quot;xx/xx&quot;;</span>
                        <span class="token string">&quot;@babel/plugin-proposal-class-properties&quot;</span><span class="token punctuation">,</span>   <span class="token comment">//解析class中的静态属性</span>
                        <span class="token string">&quot;@babel/plugin-syntax-dynamic-import&quot;</span>         <span class="token comment">//解析import方法</span>
                    <span class="token punctuation">]</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>

        <span class="token punctuation">}</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br></div></div></li> <li><p>执行编译</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">package</span><span class="token punctuation">.</span>json 的 script字段添加如下：
<span class="token string">&quot;build&quot;</span><span class="token operator">:</span> <span class="token string">&quot;webpack&quot;</span>

执行 npm run build
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>编译完成后，dist文件夹下多出一个bundle.js文件，打包成功。</p></li></ol> <h3 id="_3-3-react"><a href="#_3-3-react" class="header-anchor">#</a> 3.3 React</h3> <h4 id="_3-3-1-前置步骤"><a href="#_3-3-1-前置步骤" class="header-anchor">#</a> 3.3.1 前置步骤</h4> <ol><li><p>本地安装react</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>npm i <span class="token operator">-</span><span class="token constant">D</span> react react<span class="token operator">-</span>dom
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li><p>mian.js</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> Component <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> ReactDOM <span class="token keyword">from</span> <span class="token string">'react-dom'</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">App</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">{</span>
    <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token operator">&lt;</span>h1<span class="token operator">&gt;</span>Hello word<span class="token operator">!</span><span class="token operator">&lt;</span><span class="token operator">/</span>h1<span class="token operator">&gt;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
ReactDOM<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token operator">&lt;</span>App <span class="token operator">/</span><span class="token operator">&gt;</span><span class="token punctuation">,</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'app'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div></li></ol> <h4 id="_3-3-2-配置babel"><a href="#_3-3-2-配置babel" class="header-anchor">#</a> 3.3.2 配置Babel</h4> <p>Babel也可用于解析JSX，需要使用babel-preset-react。</p> <ol><li><p>本地安装babel-preset-react</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>npm i <span class="token operator">-</span><span class="token constant">D</span> @babel<span class="token operator">/</span>preset<span class="token operator">-</span>react
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li><p>配置webpack (在ES6环境的基础上)</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>在module<span class="token punctuation">.</span>rules中添加如下：
module<span class="token operator">:</span> <span class="token punctuation">{</span>
        rules<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>
            test<span class="token operator">:</span> <span class="token regex">/\.js$/</span><span class="token punctuation">,</span>   
            use<span class="token operator">:</span> <span class="token punctuation">{</span>
                loader<span class="token operator">:</span> <span class="token string">&quot;babel-loader&quot;</span><span class="token punctuation">,</span> 
                options<span class="token operator">:</span> <span class="token punctuation">{</span>             
                    presets<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;@babel/preset-env&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;@babel/preset-react&quot;</span><span class="token punctuation">]</span>  <span class="token comment">//用于解析ES6+React</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>

        <span class="token punctuation">}</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div></li></ol> <h3 id="_3-4-自动生成html"><a href="#_3-4-自动生成html" class="header-anchor">#</a> 3.4 自动生成HTML</h3> <h4 id="_3-4-1-单个页面"><a href="#_3-4-1-单个页面" class="header-anchor">#</a> 3.4.1 单个页面</h4> <p>使用html-webpack-plugin 自动生成HTML，并引入相应文件。</p> <ol><li><p>将index.html移到src目录下，并重命名：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>│  <span class="token keyword">package</span><span class="token punctuation">.</span>json
│  webpack<span class="token punctuation">.</span>config<span class="token punctuation">.</span>js
├─dist   
└─src
        main<span class="token punctuation">.</span>js
        template<span class="token punctuation">.</span>html
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div></li> <li><p>template.html 内容：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token operator">&lt;</span>html<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>head<span class="token operator">&gt;</span>
	<span class="token operator">&lt;</span>meta charset<span class="token operator">=</span><span class="token string">&quot;UTF-8&quot;</span><span class="token operator">&gt;</span>
	<span class="token operator">&lt;</span>title<span class="token operator">&gt;</span>自动生成<span class="token constant">HTML</span><span class="token operator">&lt;</span><span class="token operator">/</span>title<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>head<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>body<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>div id<span class="token operator">=</span><span class="token string">&quot;app&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>     <span class="token comment">//去掉手动引入script</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>body<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>html<span class="token operator">&gt;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div></li> <li><p>本地安装</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>npm i <span class="token operator">-</span><span class="token constant">D</span> html<span class="token operator">-</span>webpack<span class="token operator">-</span>plugin
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li><p>webpack配置</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> HtmlWebpackPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'html-webpack-plugin'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//引入插件</span>

plugins<span class="token operator">:</span><span class="token punctuation">[</span>
    <span class="token keyword">new</span> <span class="token class-name">HtmlWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    	template<span class="token operator">:</span><span class="token string">'./src/template.html'</span><span class="token punctuation">,</span>  <span class="token comment">//html模板</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div></li> <li><p>编译</p></li> <li><p>编译后生成的HTML</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token operator">&lt;</span>html<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>head<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>meta charset<span class="token operator">=</span><span class="token string">&quot;UTF-8&quot;</span><span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>title<span class="token operator">&gt;</span>自动生成<span class="token constant">HTML</span><span class="token operator">&lt;</span><span class="token operator">/</span>title<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>head<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>body<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>div id<span class="token operator">=</span><span class="token string">&quot;app&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>script type<span class="token operator">=</span><span class="token string">&quot;text/javascript&quot;</span> src<span class="token operator">=</span><span class="token string">&quot;bundle.js&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>   <span class="token comment">//自动引入JS文件</span>

<span class="token operator">&lt;</span><span class="token operator">/</span>body<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>html<span class="token operator">&gt;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div></li></ol> <h4 id="_3-4-2-多个页面"><a href="#_3-4-2-多个页面" class="header-anchor">#</a> 3.4.2 多个页面</h4> <p>如果单页应用中需要多个页面入口，或者多页应用时配置多个html时，那么就需要实例化该插件多次。</p> <ol><li><p>目录结构要求：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>│  <span class="token keyword">package</span><span class="token punctuation">.</span>json
│  webpack<span class="token punctuation">.</span>config<span class="token punctuation">.</span>js
│  template<span class="token punctuation">.</span>html
├─dist
└─src                 
    ├─<span class="token constant">A</span>               
    │      <span class="token constant">A</span><span class="token punctuation">.</span>js 
    └─<span class="token constant">B</span>
           <span class="token constant">B</span><span class="token punctuation">.</span>js
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div></li> <li><p>配置webpack</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> HtmlWebpackPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'html-webpack-plugin'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//引入插件</span>

entry<span class="token operator">:</span> <span class="token punctuation">{</span>                           <span class="token comment">//多入口使用对象形式配置，chunk名称为key值</span>
        <span class="token constant">A</span><span class="token operator">:</span> <span class="token string">'./src/pages/A/A.js'</span><span class="token punctuation">,</span>
        <span class="token constant">B</span><span class="token operator">:</span> <span class="token string">'./src/pages/B/B.js'</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
output<span class="token operator">:</span><span class="token punctuation">{</span>                 
        filename<span class="token operator">:</span><span class="token string">'[name].bundle.js'</span><span class="token punctuation">,</span>  <span class="token comment">//[name]代表chunk名称</span>
        path<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'dist'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>

plugins<span class="token operator">:</span><span class="token punctuation">[</span>
    <span class="token keyword">new</span> <span class="token class-name">HtmlWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        chunks<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'A'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>           <span class="token comment">//要引入的chunk</span>
        filename<span class="token operator">:</span><span class="token string">'A.html'</span><span class="token punctuation">,</span>       <span class="token comment">//生成的文件名</span>
        template<span class="token operator">:</span><span class="token string">'template.html'</span><span class="token punctuation">,</span>  <span class="token comment">//模板文件</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">new</span> <span class="token class-name">HtmlWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        chunks<span class="token operator">:</span><span class="token punctuation">[</span><span class="token string">'B'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        filename<span class="token operator">:</span><span class="token string">'B.html'</span><span class="token punctuation">,</span>
        template<span class="token operator">:</span><span class="token string">'template.html'</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div></li> <li><p>编译后的目录结构</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>│  <span class="token keyword">package</span><span class="token punctuation">.</span>json
│  webpack<span class="token punctuation">.</span>config<span class="token punctuation">.</span>js
│  template<span class="token punctuation">.</span>html
├─dist
<span class="token operator">|</span>	<span class="token constant">A</span><span class="token punctuation">.</span>bundle<span class="token punctuation">.</span>js
<span class="token operator">|</span>	<span class="token constant">A</span><span class="token punctuation">.</span>html
│  	<span class="token constant">B</span><span class="token punctuation">.</span>bundle<span class="token punctuation">.</span>js
│  	<span class="token constant">B</span><span class="token punctuation">.</span>html
└─src                 
    ├─<span class="token constant">A</span>               
    │      <span class="token constant">A</span><span class="token punctuation">.</span>js 
    └─<span class="token constant">B</span>
           <span class="token constant">B</span><span class="token punctuation">.</span>js
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div></li></ol> <h3 id="_3-5-webpack-dev-server"><a href="#_3-5-webpack-dev-server" class="header-anchor">#</a> 3.5 Webpack-dev-server</h3> <p>webpack-dev-server提供了一个简单的服务器，用于访问 webpack 构建好的静态文件，我们日常开发时可以使用它来调试前端代码。 webpack-dev-server将构建好的项目存在内存中。</p> <p>DevServer 支持模块热替换, 可在不刷新整个网页的情况下实时预览页面。 原理是当一个源码发生变化时，只重新编译发生变化的模块，再用新输出的模块替换掉浏览器中对应的老模块。</p> <h4 id="_3-5-1-devserver"><a href="#_3-5-1-devserver" class="header-anchor">#</a> 3.5.1 devServer</h4> <ol><li><p>本地安装devServer</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>npm i <span class="token operator">-</span><span class="token constant">D</span> webpack<span class="token operator">-</span>dev<span class="token operator">-</span>server
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li><p>配置webpack：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> webpack <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'webpack'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>HotModuleReplacementPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment">//启用 HMR (webpack 4)</span>
<span class="token punctuation">]</span><span class="token punctuation">,</span>

devServer<span class="token operator">:</span><span class="token punctuation">{</span>
        hot<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>                 <span class="token comment">//开启模块热替换</span>
        contentBase<span class="token operator">:</span> <span class="token string">'./dist'</span><span class="token punctuation">,</span>     <span class="token comment">//将dist目录下的文件，作为额外可访问文件</span>
        host<span class="token operator">:</span> <span class="token string">'0.0.0.0'</span><span class="token punctuation">,</span>           <span class="token comment">//DevServer 服务监听的地址，默认是localhost。当需要同个局域网可访问你的服务时，可设成0.0.0.0</span>
        port<span class="token operator">:</span> <span class="token number">3000</span><span class="token punctuation">,</span>                <span class="token comment">//DevServer 服务监听的端口，默认8080</span>
        https<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>              <span class="token comment">//是否使用HTTPS服务</span>
        open<span class="token operator">:</span> <span class="token boolean">true</span>                 <span class="token comment">//自动打开网页，地址是host:port</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>

只有在通过 DevServer 去启动 Webpack 时配置文件里 devServer 才会生效，因为这些参数所对应的功能都是 DevServer 提供的，Webpack 本身并不认识 devServer 配置项。 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div></li> <li><p>执行编译</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">package</span><span class="token punctuation">.</span>json 的 script字段添加如下：
<span class="token string">&quot;start&quot;</span><span class="token operator">:</span> <span class="token string">&quot;webpack-dev-server&quot;</span>

执行 npm start
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div></li> <li><p><a href="http://192.168.1.87:3000/A.html" target="_blank" rel="noopener noreferrer">http://192.168.1.87:3000/A.html<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></li></ol> <h4 id="_3-5-2-open-browser-webpack-plugin"><a href="#_3-5-2-open-browser-webpack-plugin" class="header-anchor">#</a> 3.5.2 open-browser-webpack-plugin</h4> <ol><li><p>本地安装</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>npm i <span class="token operator">-</span><span class="token constant">D</span> open<span class="token operator">-</span>browser<span class="token operator">-</span>webpack<span class="token operator">-</span>plugin
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li><p>配置webpack</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> OpenBrowserPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'open-browser-webpack-plugin'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token keyword">new</span> <span class="token class-name">OpenBrowserPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span> url<span class="token operator">:</span> <span class="token string">'http://192.168.1.87:3000/A.html'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>  <span class="token comment">//开启服务后，自动打开的地址</span>
<span class="token punctuation">]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div></li> <li><p>执行 npm start后，会自动打开http://192.168.1.87:3000/A.html页。</p></li></ol> <h3 id="_3-6-加载样式"><a href="#_3-6-加载样式" class="header-anchor">#</a> 3.6 加载样式</h3> <p>webpack本身只认得JS文件，其他非JS文件需要用loader进行转换。</p> <h4 id="_3-6-1-加载css"><a href="#_3-6-1-加载css" class="header-anchor">#</a> 3.6.1 加载CSS</h4> <p>处理css文件，需要用到以下两个loader：</p> <ul><li><strong>css-loader</strong> 负责解析 CSS 代码，主要是为了处理 CSS 中的依赖，例如 @import 和 url() 等引用外部文件的声明。</li> <li><strong>style-loader</strong> 会将 css-loader 解析的结果转变成 JS 代码，运行时动态插入 style 标签来让 CSS 代码生效。</li></ul> <ol><li><p>本地安装loader</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>npm i <span class="token operator">-</span><span class="token constant">D</span> css<span class="token operator">-</span>loader style<span class="token operator">-</span>loader
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li><p>配置webpack</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>module<span class="token operator">:</span> <span class="token punctuation">{</span>
        rules<span class="token operator">:</span> <span class="token punctuation">[</span>
            <span class="token punctuation">{</span>
                test<span class="token operator">:</span> <span class="token regex">/\.css$/</span><span class="token punctuation">,</span>    <span class="token comment">//使用正则匹配所有需要使用此loader的文件</span>
                use<span class="token operator">:</span> <span class="token punctuation">[</span>             <span class="token comment">//先由css-loader处理后，在交给style-loader处理</span>
                    <span class="token string">'style-loader'</span><span class="token punctuation">,</span>
                    <span class="token punctuation">{</span>
                        loader<span class="token operator">:</span><span class="token string">'css-loader'</span><span class="token punctuation">,</span>
                        options<span class="token operator">:</span><span class="token punctuation">{</span>           <span class="token comment">//传入css-loader的参数</span>
                            minimize<span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">,</span>  <span class="token comment">//是否压缩css代码</span>
                            module<span class="token operator">:</span><span class="token boolean">true</span>     <span class="token comment">//是否使用css module</span>
                        <span class="token punctuation">}</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">]</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div></li></ol> <h4 id="_3-6-2-加载scss"><a href="#_3-6-2-加载scss" class="header-anchor">#</a> 3.6.2 加载SCSS</h4> <p>先将SCSS转成CSS，后续处理同上。</p> <ol><li><p>本地安装</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>npm i <span class="token operator">-</span><span class="token constant">D</span> sass<span class="token operator">-</span>loader node<span class="token operator">-</span>sass 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li><p>配置webpack</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>module<span class="token operator">:</span> <span class="token punctuation">{</span>
        rules<span class="token operator">:</span> <span class="token punctuation">[</span>
            <span class="token punctuation">{</span>
                test<span class="token operator">:</span> <span class="token regex">/\.scss$/</span><span class="token punctuation">,</span>    <span class="token comment">//使用正则匹配所有需要使用此loader的文件</span>
                use<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'style-loader'</span><span class="token punctuation">,</span><span class="token string">'css-loader'</span><span class="token punctuation">,</span> <span class="token string">'sass-loader'</span><span class="token punctuation">]</span>  <span class="token comment">//处理顺序:sass-loader-&gt;css-loader-&gt;style-loader</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div></li></ol> <h3 id="_3-7-加载静态资源"><a href="#_3-7-加载静态资源" class="header-anchor">#</a> 3.7 加载静态资源</h3> <h4 id="_3-7-1-加载图片-字体"><a href="#_3-7-1-加载图片-字体" class="header-anchor">#</a> 3.7.1 加载图片&amp;字体</h4> <p>file-loader, url-loader可用于处理图片，字体等静态资源。</p> <p>url-loader封装了file-loader：</p> <ul><li>文件大小小于limit参数时，url-loader将会把文件转为DataURL。</li> <li>文件大小大于limit，url-loader会调用file-loader进行处理。</li></ul> <ol><li><p>本地安装loader</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>npm i <span class="token operator">-</span><span class="token constant">D</span> file<span class="token operator">-</span>loader url<span class="token operator">-</span>loader
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li><p>配置webpack</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>module<span class="token operator">:</span> <span class="token punctuation">{</span>
    rules<span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span>
                test<span class="token operator">:</span> <span class="token regex">/\.(png|svg|jpg|gif)$/</span><span class="token punctuation">,</span>
                use<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>
                    loader<span class="token operator">:</span> <span class="token string">'url-loader'</span><span class="token punctuation">,</span>
                    options<span class="token operator">:</span> <span class="token punctuation">{</span>
                        limit<span class="token operator">:</span> <span class="token number">1024</span> <span class="token operator">*</span> <span class="token number">30</span><span class="token punctuation">,</span>         <span class="token comment">//30KB 以下的文件采用 url-loader</span>
                        fallback<span class="token operator">:</span> <span class="token string">'file-loader'</span><span class="token punctuation">,</span>  <span class="token comment">//否则采用 file-loader，默认值就是 file-loader</span>
                        outputPath<span class="token operator">:</span> <span class="token string">'images'</span><span class="token punctuation">,</span>     <span class="token comment">//图片输出路径，相对于output.path</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span><span class="token punctuation">]</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">{</span>
                test<span class="token operator">:</span> <span class="token regex">/\.(eot|ttf|woff|svg)$/</span><span class="token punctuation">,</span>
                use<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>
                    loader<span class="token operator">:</span> <span class="token string">'url-loader'</span><span class="token punctuation">,</span>
                    options<span class="token operator">:</span> <span class="token punctuation">{</span>
                        limit<span class="token operator">:</span> <span class="token number">1024</span> <span class="token operator">*</span> <span class="token number">30</span><span class="token punctuation">,</span>         <span class="token comment">//30KB 以下的文件采用 url-loader</span>
                        fallback<span class="token operator">:</span> <span class="token string">'file-loader'</span><span class="token punctuation">,</span>  <span class="token comment">//否则采用 file-loader，默认值就是 file-loader</span>
                        outputPath<span class="token operator">:</span> <span class="token string">'fonts'</span><span class="token punctuation">,</span>      <span class="token comment">//字体输出路径</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span><span class="token punctuation">]</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br></div></div></li> <li><p>编译后:</p> <ul><li>大于30KB的资源，用file-loader处理，复制到dist/images目录下。</li> <li>小于30KB的资源，和js一起打包，形成dataURL形式。</li></ul></li></ol> <h4 id="_3-7-2-copy-webpack-plugin"><a href="#_3-7-2-copy-webpack-plugin" class="header-anchor">#</a> 3.7.2 copy-webpack-plugin</h4> <p>将不需要webpack处理的静态资源（e.g. favicon），原样输出到指定目录下。</p> <ol><li><p>本地安装</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>npm i copy<span class="token operator">-</span>webpack<span class="token operator">-</span>plugin <span class="token operator">-</span><span class="token constant">D</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li><p>配置webpack</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> CopyWebpackPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'copy-webpack-plugin'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

plugins<span class="token operator">:</span><span class="token punctuation">[</span>
    <span class="token keyword">new</span> <span class="token class-name">CopyWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">{</span>
        <span class="token keyword">from</span><span class="token operator">:</span> <span class="token string">'./src/assets/public'</span><span class="token punctuation">,</span>  <span class="token comment">// 将此目录下的文件</span>
        to<span class="token operator">:</span><span class="token string">'./public'</span>                 <span class="token comment">// 输出到此目录，相对于output.path目录</span>
    <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div></li> <li><p>编译后 src/assets/public 下的文件将原封不动的输出到 dist/public 目录下。</p></li></ol> <h3 id="_3-8-第三方库"><a href="#_3-8-第三方库" class="header-anchor">#</a> 3.8 第三方库</h3> <p>通过ProvidePlugin引用某些模块作为应用运行时的变量，从而不必每次都用 <code>require</code> 或者 <code>import</code>, 是内置的插件。</p> <ol><li><p>安装jquery</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>npm i <span class="token operator">-</span><span class="token constant">D</span> jquery
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li><p>配置webpack</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>plugins<span class="token operator">:</span><span class="token punctuation">[</span>
    <span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>ProvidePlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      $<span class="token operator">:</span> <span class="token string">'jquery'</span><span class="token punctuation">,</span> 
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">]</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div></li> <li><p>在JS文件中就可直接使用jquery，不用导入。</p></li></ol> <h3 id="_3-9-其他"><a href="#_3-9-其他" class="header-anchor">#</a> 3.9 其他</h3> <h4 id="_3-9-1-clean-webpack-plugin"><a href="#_3-9-1-clean-webpack-plugin" class="header-anchor">#</a> 3.9.1 clean-webpack-plugin</h4> <p>webpack打包的文件都放在dist文件夹下，但webpack无法追踪到哪些文件是实际项目中用到的。所以建议在每次构建前都清理下dist文件夹。</p> <ol><li><p>本地安装插件</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>npm i <span class="token operator">-</span><span class="token constant">D</span> clean<span class="token operator">-</span>webpack<span class="token operator">-</span>plugin
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li><p>配置webpack</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> CleanWebpackPlugin<span class="token operator">=</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'clean-webpack-plugin'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">new</span> <span class="token class-name">CleanWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'dist'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div></li></ol> <h4 id="_3-9-2-webpack-merge"><a href="#_3-9-2-webpack-merge" class="header-anchor">#</a> 3.9.2 Webpack-merge</h4> <p>实际项目开发中，一般会有三份配置文件：</p> <ul><li>webpack.dev.js  开发环境：devserver配置，生成SourceMap</li> <li>webpack.prod.js  生产环境：压缩代码</li> <li>webpack.common.js  公共配置</li></ul> <p>可使用webpack-merge合并配置。</p> <ol><li><p>本地安装</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>npm i <span class="token operator">-</span><span class="token constant">D</span> webpack<span class="token operator">-</span>merge
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li><p>拆分webpack配置</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>webpack<span class="token punctuation">.</span>prod<span class="token punctuation">.</span>js<span class="token operator">:</span>

<span class="token keyword">const</span> merge <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;webpack-merge&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> common <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;./webpack.common.js&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token comment">//引入公共配置</span>
<span class="token keyword">const</span> CleanWebpackPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;clean-webpack-plugin&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token function">merge</span><span class="token punctuation">(</span>common<span class="token punctuation">,</span> <span class="token punctuation">{</span>                   <span class="token comment">//合并配置</span>
        plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
            <span class="token keyword">new</span> <span class="token class-name">CleanWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">&quot;dist&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div></li> <li><p>修改package.json的script字段</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token string">&quot;build&quot;</span><span class="token operator">:</span> <span class="token string">&quot;webpack --config webpack.prod.js&quot;</span><span class="token punctuation">,</span>
<span class="token string">&quot;start&quot;</span><span class="token operator">:</span> <span class="token string">&quot;webpack-dev-server --config webpack.dev.js&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></li></ol> <h4 id="_3-9-3-source-map"><a href="#_3-9-3-source-map" class="header-anchor">#</a> 3.9.3 source map</h4> <p>React, ES6等经过webpack转换后，代码可读性非常差，不利于在浏览器中调试代码。可通过加载 Source Map 文件，在浏览器中调试源码。</p> <p>各种source map的差异见：https://github.com/webpack/webpack/tree/master/examples/source-map</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>devtool<span class="token operator">:</span> <span class="token string">&quot;cheap-module-eval-source-map&quot;</span>  <span class="token comment">//开发环境</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h2 id="_4-优化"><a href="#_4-优化" class="header-anchor">#</a> 4. 优化</h2> <h3 id="_4-1-模式"><a href="#_4-1-模式" class="header-anchor">#</a> 4.1 模式</h3> <p>我们在日常的前端开发工作中，一般都会有开发&amp;生产两套构建环境。</p> <p>webpack 4.X新增用mode字段指定当前环境，并启用相应模式下的webpack内置的优化。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  mode<span class="token operator">:</span> <span class="token string">'production'</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><table><thead><tr><th>选项</th> <th>描述</th></tr></thead> <tbody><tr><td>development   (开发环境)</td> <td>process.env.NODE_ENV =development<br>并启用以下插件：<br> NamedChunksPlugin ， NamedModulesPlugin</td></tr> <tr><td>production       (生产环境)</td> <td>process.env.NODE_ENV =production<br>并启用以下插件：<br>FlagDependencyUsagePlugin  ，  FlagIncludedChunksPlugin ,  ModuleConcatenationPlugin ,  NoEmitOnErrorsPlugin ,  OccurrenceOrderPlugin ,  SideEffectsFlagPlugin  ,  UglifyJsPlugin</td></tr></tbody></table> <p>可通过optimization字段，手动配置或覆盖mode配置。</p> <h3 id="_4-2-代码压缩"><a href="#_4-2-代码压缩" class="header-anchor">#</a> 4.2 代码压缩</h3> <h4 id="_4-2-1-压缩js文件"><a href="#_4-2-1-压缩js文件" class="header-anchor">#</a> 4.2.1 压缩JS文件</h4> <p>将mode设置成production，在此模式下optimization.minimize默认为true, webpack 会自动调用UglifyjsWebpackPlugin压缩JS代码。</p> <p>若不需要压缩，可将optimization.minimize设置为false。</p> <ol><li><p>配置webpack.prod.js</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>mode<span class="token operator">:</span> <span class="token string">&quot;production&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="language-js line-numbers-mode"><pre class="language-js"><code>optimization<span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token comment">// minimize:false，     //若不需要进行压缩，可使用此句禁用</span>
        <span class="token comment">// minimizer: [         //用于指定使用的压缩插件或自定义UglifyjsWebpackPlugin插件配置，覆盖默认配置。</span>
        <span class="token comment">//     new UglifyJsPlugin({ /* your config */ })</span>
        <span class="token comment">// ]</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div></li></ol> <h4 id="_4-2-2-压缩css文件"><a href="#_4-2-2-压缩css文件" class="header-anchor">#</a> 4.2.2 压缩CSS文件</h4> <p>3.7章节介绍了如何加载样式，但加载后的样式是写在JS文件中的。随着项目越来越大，js文件也会越来越大，所以，我们就需要对css文件进行分离并压缩。</p> <ol><li><p>本地安装插件</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>npm i <span class="token operator">-</span><span class="token constant">D</span> mini<span class="token operator">-</span>css<span class="token operator">-</span>extract<span class="token operator">-</span>plugin optimize<span class="token operator">-</span>css<span class="token operator">-</span>assets<span class="token operator">-</span>webpack<span class="token operator">-</span>plugin uglifyjs<span class="token operator">-</span>webpack<span class="token operator">-</span>plugin
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li><p>配置webpack：分离css文件</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>webpack<span class="token punctuation">.</span>common<span class="token punctuation">.</span>js<span class="token operator">:</span>
<span class="token keyword">const</span> MiniCssExtractPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;mini-css-extract-plugin&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token keyword">new</span> <span class="token class-name">MiniCssExtractPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      filename<span class="token operator">:</span> <span class="token string">&quot;[name].css&quot;</span><span class="token punctuation">,</span>    <span class="token comment">// [name]为chunk名称</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  module<span class="token operator">:</span> <span class="token punctuation">{</span>
    rules<span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        test<span class="token operator">:</span> <span class="token regex">/\.(sc|c)ss$/</span><span class="token punctuation">,</span>
        use<span class="token operator">:</span> <span class="token punctuation">[</span>
            MiniCssExtractPlugin<span class="token punctuation">.</span>loader<span class="token punctuation">,</span>   <span class="token comment">// style-loader改用MiniCssExtractPlugin</span>
            <span class="token string">'css-loader'</span><span class="token punctuation">,</span>
            <span class="token string">'sass-loader'</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

注：在Webpack4上用extract<span class="token operator">-</span>text<span class="token operator">-</span>webpack<span class="token operator">-</span>plugin会出错，可以安装beta版本extract<span class="token operator">-</span>text<span class="token operator">-</span>webpack<span class="token operator">-</span>plugin@next。
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div></li> <li><p>配置webpack：压缩css文件</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>webpack<span class="token punctuation">.</span>prod<span class="token punctuation">.</span>js<span class="token operator">:</span>
<span class="token keyword">const</span> OptimizeCSSAssetsPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;optimize-css-assets-webpack-plugin&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//用于压缩CSS代码</span>
<span class="token keyword">const</span> UglifyJsPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;uglifyjs-webpack-plugin&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//用于压缩JS代码</span>

optimization<span class="token operator">:</span> <span class="token punctuation">{</span>
        minimizer<span class="token operator">:</span> <span class="token punctuation">[</span>   
            <span class="token keyword">new</span> <span class="token class-name">UglifyJsPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token keyword">new</span> <span class="token class-name">OptimizeCSSAssetsPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>  <span class="token comment">//压缩css</span>
        <span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div></li></ol> <h4 id="_4-2-3-压缩html文件"><a href="#_4-2-3-压缩html文件" class="header-anchor">#</a> 4.2.3 压缩HTML文件</h4> <p>HtmlWebpackPlugin支持压缩输出的HTML文件。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code> plugins<span class="token operator">:</span><span class="token punctuation">[</span>
    <span class="token keyword">new</span> <span class="token class-name">HtmlWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    	template<span class="token operator">:</span><span class="token string">'src/index.html'</span><span class="token punctuation">,</span> 
    	minify<span class="token operator">:</span><span class="token punctuation">{</span>                     <span class="token comment">//压缩输出</span>
            collapseWhitespace<span class="token operator">:</span><span class="token boolean">true</span>   <span class="token comment">//折叠空白区域</span>
            minifyCSS<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> 	<span class="token comment">// 压缩 HTML 中出现的 CSS 代码</span>
        	minifyJS<span class="token operator">:</span> <span class="token boolean">true</span> 		<span class="token comment">// 压缩 HTML 中出现的 JS 代码</span>
    	<span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h4 id="_4-2-4-压缩图片"><a href="#_4-2-4-压缩图片" class="header-anchor">#</a> 4.2.4 压缩图片</h4> <ol><li><p>本地安装</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>npm i <span class="token operator">-</span><span class="token constant">D</span> image<span class="token operator">-</span>webpack<span class="token operator">-</span>loader
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li><p>配置webpack</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token punctuation">{</span>
    test<span class="token operator">:</span> <span class="token regex">/\.(png|svg|jpg|gif)$/</span><span class="token punctuation">,</span>
    use<span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span>
            loader<span class="token operator">:</span> <span class="token string">'url-loader'</span><span class="token punctuation">,</span>
            options<span class="token operator">:</span> <span class="token punctuation">{</span>
                limit<span class="token operator">:</span> <span class="token number">1024</span> <span class="token operator">*</span> <span class="token number">30</span><span class="token punctuation">,</span>       
                fallback<span class="token operator">:</span> <span class="token string">'file-loader'</span><span class="token punctuation">,</span>  
                outputPath<span class="token operator">:</span> <span class="token string">'images'</span><span class="token punctuation">,</span>  
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
    	<span class="token string">'image-webpack-loader'</span>        <span class="token comment">// 压缩图片</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div></li></ol> <h3 id="_4-3-tree-sharing"><a href="#_4-3-tree-sharing" class="header-anchor">#</a> 4.3 Tree Sharing</h3> <p>Tree Shaking 可以用来剔除 JavaScript 中用不上的代码。</p> <p>Tree Shaking要求：</p> <ul><li>必须遵循 ES6 的模块规范（即 import 和 export）。</li> <li>在项目 <code>package.json</code> 文件中，添加一个 &quot;sideEffects&quot; 属性。作用于引入重导出的模块。</li> <li>引入一个能够删除未引用代码(dead code)的压缩工具(minifier)（例如 <code>UglifyJSPlugin</code>）。</li></ul> <ol><li><p>新建util.js</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">export</span> funcA <span class="token keyword">from</span> <span class="token string">'./TESTA'</span>
<span class="token keyword">export</span> funcB <span class="token keyword">from</span> <span class="token string">'./TESTB'</span>

<span class="token constant">TESTA</span><span class="token punctuation">.</span>js<span class="token operator">:</span>
<span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">funcA</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token operator">&lt;</span>h1<span class="token operator">&gt;</span><span class="token constant">I</span>'m funcA<span class="token operator">&lt;</span><span class="token operator">/</span>h1<span class="token operator">&gt;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;funcAfuncAfuncA&quot;</span><span class="token punctuation">)</span>   <span class="token comment">// 副作用代码</span>

<span class="token constant">TESTB</span><span class="token punctuation">.</span>js<span class="token operator">:</span>
<span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">funcB</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token operator">&lt;</span>h1<span class="token operator">&gt;</span><span class="token constant">I</span>'m funcB<span class="token operator">&lt;</span><span class="token operator">/</span>h1<span class="token operator">&gt;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;funcBfuncBfuncB&quot;</span><span class="token punctuation">)</span>  <span class="token comment">// 副作用代码</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div></li> <li><p>在A.js中引用util.funcA，则funcB就是用不上的代码。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span>funcA<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'../util'</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li><p>修改babel-loader配置。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>presets<span class="token operator">:</span> <span class="token punctuation">[</span> 
    <span class="token punctuation">[</span>
        <span class="token string">&quot;env&quot;</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span>modules<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">}</span>  <span class="token comment">// 关闭Babel的模块转换功能，保留原本的ES6模块化语法</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token string">&quot;react&quot;</span>
<span class="token punctuation">]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div></li> <li><p>package.json添加sideEffects字段： 将文件标记为无副作用</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token string">&quot;sideEffects&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;*.css&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;*.scss&quot;</span><span class="token punctuation">]</span>  <span class="token comment">//避免样式文件被删除</span>

注：此字段是webpack4新增的。
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div></li> <li><p>开启压缩，参照4.2.1</p> <p>执行编译后，A.bundle.js无funcB相关代码。</p></li></ol> <h3 id="_4-4-提取公共代码"><a href="#_4-4-提取公共代码" class="header-anchor">#</a> 4.4 提取公共代码</h3> <p>提取公共代码的原理：用户第一次访问页面后，页面公共代码的文件已经被浏览器缓存起来。用户切换到其它页面时，存放公共代码的文件就不会再重新加载，而是直接从缓存中获取。 加快了其他页面的访问速度，减少了网络传输流量。</p> <p>3种拆分方案浏览器的加载情况：</p> <ul><li>未拆分代码：所有代码被打包到一个JS文件中，当修改了代码，浏览器就得重新加载所有代码。</li> <li>拆分公共代码：代码被打包成两个JS文件（公共代码 &amp; 其余代码），修改其中一个文件的代码，浏览器只需要重新加载修改的代码文件。但第三方库的代码也属于公共代码，若修改了非第三方库的公共代码，那么浏览器也会重新加载不常变更的第三方库代码。</li> <li>拆分公共代码&amp;第三方库：代码被打包成3个以上的JS文件。</li></ul> <p>mode=production时，webpack 4.X 会默认对代码进行拆分，拆分的规则是：</p> <ul><li>模块被重复引用，或者是来自<code>node_modules</code>中的模块。</li> <li>文件大于30kb。</li> <li>在按需加载时，请求数量小于等于5。</li> <li>在初始化加载时，请求数量小于等于3。</li></ul> <p>注：webpack 4.x 通过optimization.splitChunks配置, webpack 4.x之前可用CommonsChunkPlugin。</p> <p>默认配置：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>optimization<span class="token operator">:</span> <span class="token punctuation">{</span>
    splitChunks<span class="token operator">:</span> <span class="token punctuation">{</span>
      chunks<span class="token operator">:</span> <span class="token string">&quot;async&quot;</span><span class="token punctuation">,</span> <span class="token comment">//异步加载的模块</span>
      minSize<span class="token operator">:</span> <span class="token number">30000</span><span class="token punctuation">,</span> <span class="token comment">//模块大于30k会被抽离到公共模块</span>
      minChunks<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token comment">//被引用超过1次</span>
      maxAsyncRequests<span class="token operator">:</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token comment">//异步模块，一次最多只能被加载5个</span>
      maxInitialRequests<span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token comment">//入口模块最多只能加载3个</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>拆分公共代码配置：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>optimization<span class="token operator">:</span> <span class="token punctuation">{</span>
    splitChunks<span class="token operator">:</span> <span class="token punctuation">{</span>
      chunks<span class="token operator">:</span> <span class="token string">&quot;all&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 所有的 chunks 代码公共的部分分离出来成为一个单独的文件</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>拆分公共代码&amp;第三方库配置:</p> <ul><li>根据所使用的技术栈，找出所有页面都需要用到的基础库。如react、react-dom 等库，把它们提取到一个单独vendor.js文件。</li> <li>在剔除了各个页面中被 vendor.js 包含的部分代码外，再找出所有页面都依赖的公共部分的代码提取出来放到 common.js中去。</li> <li>再为每个页面都生成一个单独的文件，这个文件中不再包含 vendor.js 和 common.js中包含的部分，而只包含各个页面单独需要的部分代码。</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code>optimization<span class="token operator">:</span> <span class="token punctuation">{</span>
    splitChunks<span class="token operator">:</span> <span class="token punctuation">{</span>
            cacheGroups<span class="token operator">:</span> <span class="token punctuation">{</span>           <span class="token comment">//缓存组</span>
                commons<span class="token operator">:</span> <span class="token punctuation">{</span>           <span class="token comment">//提取入口文件之间的公共代码</span>
                    chunks<span class="token operator">:</span> <span class="token string">'all'</span><span class="token punctuation">,</span>   <span class="token comment">//块的范围，有三个可选值：initial、async、all，默认为all</span>
                    minChunks<span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>    <span class="token comment">//被引用次数</span>
                    minSize<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>      <span class="token comment">//文件大小</span>
                    name<span class="token operator">:</span> <span class="token string">&quot;common&quot;</span>   <span class="token comment">//拆分出来块的名字</span>
                <span class="token punctuation">}</span><span class="token punctuation">,</span>
                vendor<span class="token operator">:</span> <span class="token punctuation">{</span>
                    chunks<span class="token operator">:</span> <span class="token string">&quot;all&quot;</span><span class="token punctuation">,</span>
                    test<span class="token operator">:</span> <span class="token regex">/node_modules/</span><span class="token punctuation">,</span><span class="token comment">//控制哪些模块被这个缓存组匹配到</span>
                    name<span class="token operator">:</span> <span class="token string">&quot;vendor&quot;</span><span class="token punctuation">,</span>
                    priority<span class="token operator">:</span> <span class="token number">10</span><span class="token punctuation">,</span>
                <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">new</span> <span class="token class-name">HtmlWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    chunks<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'A'</span><span class="token punctuation">,</span><span class="token string">'common'</span><span class="token punctuation">,</span><span class="token string">'vendor'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>           <span class="token comment">//引入拆分出来的chunk</span>
    filename<span class="token operator">:</span><span class="token string">'A.html'</span><span class="token punctuation">,</span>    
    template<span class="token operator">:</span><span class="token string">'template.html'</span><span class="token punctuation">,</span> 
    minify<span class="token operator">:</span><span class="token punctuation">{</span>               
    	collapseWhitespace<span class="token operator">:</span><span class="token boolean">true</span>  
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>编译完成后dist目录结构如下：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>│  <span class="token constant">A</span><span class="token punctuation">.</span>bundle<span class="token punctuation">.</span>js
│  <span class="token constant">A</span><span class="token punctuation">.</span>css
│  <span class="token constant">A</span><span class="token punctuation">.</span>html
│  <span class="token constant">B</span><span class="token punctuation">.</span>bundle<span class="token punctuation">.</span>js
│  <span class="token constant">B</span><span class="token punctuation">.</span>css
│  <span class="token constant">B</span><span class="token punctuation">.</span>html
│  common<span class="token punctuation">.</span>bundle<span class="token punctuation">.</span>js           <span class="token comment">//A和B之间的公共代码</span>
│  vendor<span class="token punctuation">.</span>bundle<span class="token punctuation">.</span>js           <span class="token comment">//node_modules下的第三方依赖代码</span>
├─images
│      <span class="token number">230280</span>f0ff880c8273b99fdae150dc96<span class="token punctuation">.</span>png
└─<span class="token keyword">public</span>
        ico<span class="token punctuation">.</span>png
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><h3 id="_4-5-优化loader配置"><a href="#_4-5-优化loader配置" class="header-anchor">#</a> 4.5 优化loader配置</h3> <p>使用 Loader 时可以通过 test 、 include、 exclude 三个配置项来命中 Loader 要应用规则的文件。 为了尽可能少的让文件被 Loader 处理，可以通过 include &amp;&amp; exclude 去命中/排除文件。</p> <p>示例配置：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>babel<span class="token operator">-</span>loader<span class="token operator">:</span>
exclude<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'node_modules'</span><span class="token punctuation">)</span>

url<span class="token operator">-</span>loader：
include<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'src/assets'</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="_4-6-resolve"><a href="#_4-6-resolve" class="header-anchor">#</a> 4.6 Resolve</h3> <p>Webpack 在启动后会从配置的入口模块出发找出所有依赖的模块，Resolve 配置 Webpack 如何寻找模块所对应的文件。</p> <p>模块引入方式：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> m <span class="token keyword">from</span> <span class="token string">'./index.css'</span>   <span class="token comment">// 相对路径</span>
<span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span>         <span class="token comment">// 模块名</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><ul><li>解析相对路径
<ol><li>查找相对当前模块的路径下是否有对应文件或文件夹</li> <li>是文件则直接加载</li> <li>是文件夹则继续查找文件夹下的 package.json 文件</li> <li>有 package.json 文件则按照文件中 browser/module/main 字段的文件名来查找文件 (配置项：resolve.mainFields )</li> <li>无 package.json 或者无 browser/module/main字段则查找 index.js 文件  (配置项：resolve.mainFiles)</li></ol></li> <li>解析模块名
<ol><li>查找当前文件目录下，父级目录及以上目录下的 node_modules 文件夹，看是否有对应名称的模块  (配置项：resolve.modules)</li></ol></li></ul> <h4 id="_4-6-1-resolve-modules"><a href="#_4-6-1-resolve-modules" class="header-anchor">#</a> 4.6.1 resolve.modules</h4> <p>resolve.modules 用于配置 Webpack 去哪些目录下寻找第三方模块。</p> <p>默认值是 ['node_modules']，作用：</p> <ul><li>先去当前目录下的node_modules目录下查找第三方模块。</li> <li>如果没找到，就去上级目录的node_modules目录下查找。</li> <li>还是没找到，再去上级的node_modules目录下查找。</li> <li>直到根目录。</li></ul> <p>通常安装的第三方模块都放在项目根目录下的 node_modules 目录下，就没有必要按照默认的方式去一层层的寻找，可以指明存放第三方模块的绝对路径，以减少寻找。</p> <p>配置如下：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  resolve<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token comment">// 使用绝对路径指明第三方模块存放的位置，以减少搜索步骤</span>
    modules<span class="token operator">:</span> <span class="token punctuation">[</span>path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'node_modules'</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h4 id="_4-6-2-resolve-extensions"><a href="#_4-6-2-resolve-extensions" class="header-anchor">#</a> 4.6.2 resolve.extensions</h4> <p>resolve.extensions 用于配置在尝试过程中用到的后缀列表，默认是：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>extensions<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'.js'</span><span class="token punctuation">,</span> <span class="token string">'.json'</span><span class="token punctuation">]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>如果这个列表越长，或者正确的后缀在越后面，就会造成尝试的次数越多。</p> <p>建议：</p> <ul><li>后缀尝试列表要尽可能的小，不要把项目中不可能存在的情况写到后缀尝试列表中。</li> <li>频率出现最高的文件后缀要优先放在最前面，以做到尽快的退出寻找过程。</li> <li>在源码中写导入语句时，要尽可能的带上后缀，从而可以避免寻找过程。例如在你确定的情况下把 <code>require('./data')</code> 写成 <code>require('./data.json')</code>。</li></ul> <p>相关 Webpack 配置如下：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  resolve<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token comment">// 尽可能的减少后缀尝试的可能性</span>
    extensions<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'.js'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h4 id="_4-6-3-resolve-alias"><a href="#_4-6-3-resolve-alias" class="header-anchor">#</a> 4.6.3 resolve.alias</h4> <p><code>resolve.alias</code> 配置项通过别名来把原导入路径映射成一个新的导入路径，可简化import/require路径。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>resolve<span class="token operator">:</span><span class="token punctuation">{</span>
  alias<span class="token operator">:</span><span class="token punctuation">{</span>
    <span class="token string">'assets'</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'src'</span><span class="token punctuation">,</span><span class="token string">'assets'</span><span class="token punctuation">)</span>   <span class="token comment">//把导入语句里的 assets 关键字替换成 根目录/src/assets/</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p><code>import img from 'assets/images/1.png'</code> ==&gt; <code>import img from 'xx/src/assets/images/1.png'</code>。</p> <p>css中的url不支持。</p> <p>解决在webstorm中无法解析alias后的路径：</p> <ol><li>在webpack settings中指定webpack配置文件的路径。</li> <li>由于我们脚手架的webpack配置中resolve.alias配置是直接写在alias字段下的，webstorm无法解析。所以需要在配置文件中配置resolve.alias字段。</li></ol> <h3 id="_4-7-hash"><a href="#_4-7-hash" class="header-anchor">#</a> 4.7 Hash</h3> <p>在打包出来的文件名上加上文件内容的<code>hash</code>是目前最常见的有效使用浏览器长缓存的方法，js文件如果有内容更新，<code>hash</code>就会更新，浏览器请求路径变化所以更新缓存，如果js内容不变，<code>hash</code>不变，直接用缓存。</p> <p>hash类型：</p> <ul><li><strong>hash</strong> 跟整个项目的构建相关，只要项目里有文件更改，整个项目构建的hash值都会更改，并且全部文件都共用相同的hash值。</li> <li><strong>chunkhash</strong> 和hash不一样，它根据不同的入口文件(Entry)进行依赖文件解析、构建对应的chunk，生成对应的哈希值。</li> <li><strong>contenthash</strong> 更细致地根据内容更改，生成对应的哈希值。为css文件生成独立的hash，让css文件不受js文件的影响。</li></ul> <p>webpack配置：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>output<span class="token operator">:</span><span class="token punctuation">{</span>              
        filename<span class="token operator">:</span><span class="token string">'[name].[chunkhash:8].bundle.js'</span><span class="token punctuation">,</span> 
        path<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'dist'</span><span class="token punctuation">)</span> 
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
plugins<span class="token operator">:</span><span class="token punctuation">[</span>
        <span class="token keyword">new</span> <span class="token class-name">MiniCssExtractPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            filename<span class="token operator">:</span> <span class="token string">&quot;[name].[contenthash:8].css&quot;</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h3 id="_4-8-遗留"><a href="#_4-8-遗留" class="header-anchor">#</a> 4.8 遗留</h3> <h4 id="_4-8-1-热更新-（react-hot-loader）"><a href="#_4-8-1-热更新-（react-hot-loader）" class="header-anchor">#</a> 4.8.1 热更新 （react-hot-loader）</h4> <ol><li><p>安装</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>yarn add react<span class="token operator">-</span>hot<span class="token operator">-</span>loader
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li><p>webpack配置</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token number">1.</span>使用HotModuleReplacementPlugin插件
    plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>HotModuleReplacementPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token number">2.</span>开启devServer的模块热替换
    devServer<span class="token operator">:</span><span class="token punctuation">{</span>
        hot<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>                 <span class="token comment">//开启模块热替换</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token number">3.</span>在babel<span class="token operator">-</span>loader中使用react<span class="token operator">-</span>hot<span class="token operator">-</span>loader<span class="token operator">/</span>babel插件
    plugins<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;react-hot-loader/babel&quot;</span>           
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div></li> <li><h5 id="入口文件设置"><a href="#入口文件设置" class="header-anchor">#</a> 入口文件设置</h5> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> Component <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> AppContainer <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react-hot-loader'</span><span class="token punctuation">;</span>  
<span class="token keyword">import</span> ReactDOM <span class="token keyword">from</span> <span class="token string">'react-dom'</span><span class="token punctuation">;</span>
<span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./a.css'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> Test <span class="token keyword">from</span> <span class="token string">'./Test'</span><span class="token punctuation">;</span>


<span class="token keyword">function</span> <span class="token function">render</span><span class="token punctuation">(</span><span class="token parameter">RootElement</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  ReactDOM<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>AppContainer<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>RootElement <span class="token operator">/</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>AppContainer<span class="token operator">&gt;</span><span class="token punctuation">,</span>
    document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'app'</span><span class="token punctuation">)</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token function">render</span><span class="token punctuation">(</span>Test<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span>module<span class="token punctuation">.</span>hot<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  module<span class="token punctuation">.</span>hot<span class="token punctuation">.</span><span class="token function">accept</span><span class="token punctuation">(</span><span class="token string">'./Test'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">render</span><span class="token punctuation">(</span>Test<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div></li></ol> <h4 id="_4-8-2-proxy"><a href="#_4-8-2-proxy" class="header-anchor">#</a> 4.8.2 Proxy</h4> <p>proxy 用于配置 webpack-dev-server 将特定 URL 的请求代理到另外一台服务器上。例如：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>proxy<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string">'/api/test'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        target<span class="token operator">:</span> <span class="token string">&quot;http://localhost:3000&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 将URL中带有/api/test的请求代理到本地的3000端口的服务上</span>
        pathRewrite<span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token string">'^/api'</span><span class="token operator">:</span> <span class="token string">''</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token comment">// 把URL中path部分的api移除掉</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><ol><li>请求到 <code>/api/test</code> 会被代理到请求 <a href="http://localhost:3000/api/users" target="_blank" rel="noopener noreferrer"><code>http://localhost:3000/api/users</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</li> <li>请求到 <code>/api/test</code> 会被代理到请求 <a href="http://localhost:3000/users" target="_blank" rel="noopener noreferrer"><code>http://localhost:3000/users</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</li></ol></div> <footer class="page-edit" style="display:none;"><!----> <div class="last-updated"><span class="prefix">Last Updated: </span> <span class="time">2020年12月11日星期五下午5点02分</span></div></footer> <!----> <!----> <ul class="side-bar sub-sidebar-wrapper" style="width:12rem;" data-v-40a3448a><li class="level-2" data-v-40a3448a><a href="/docs/react/%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E6%90%AD%E5%BB%BAReact%E9%A1%B9%E7%9B%AE.html#_1-webpack基础概念" class="sidebar-link" data-v-40a3448a>1. Webpack基础概念</a></li><li class="level-2" data-v-40a3448a><a href="/docs/react/%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E6%90%AD%E5%BB%BAReact%E9%A1%B9%E7%9B%AE.html#_2-项目需求" class="sidebar-link" data-v-40a3448a>2. 项目需求</a></li><li class="level-2" data-v-40a3448a><a href="/docs/react/%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E6%90%AD%E5%BB%BAReact%E9%A1%B9%E7%9B%AE.html#_3-实战" class="sidebar-link" data-v-40a3448a>3. 实战</a></li><li class="level-3" data-v-40a3448a><a href="/docs/react/%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E6%90%AD%E5%BB%BAReact%E9%A1%B9%E7%9B%AE.html#_3-1-基础环境" class="sidebar-link" data-v-40a3448a>3.1 基础环境</a></li><li class="level-3" data-v-40a3448a><a href="/docs/react/%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E6%90%AD%E5%BB%BAReact%E9%A1%B9%E7%9B%AE.html#_3-2-es6" class="sidebar-link" data-v-40a3448a>3.2 ES6</a></li><li class="level-3" data-v-40a3448a><a href="/docs/react/%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E6%90%AD%E5%BB%BAReact%E9%A1%B9%E7%9B%AE.html#_3-3-react" class="sidebar-link" data-v-40a3448a>3.3 React</a></li><li class="level-3" data-v-40a3448a><a href="/docs/react/%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E6%90%AD%E5%BB%BAReact%E9%A1%B9%E7%9B%AE.html#_3-4-自动生成html" class="sidebar-link" data-v-40a3448a>3.4 自动生成HTML</a></li><li class="level-3" data-v-40a3448a><a href="/docs/react/%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E6%90%AD%E5%BB%BAReact%E9%A1%B9%E7%9B%AE.html#_3-5-webpack-dev-server" class="sidebar-link" data-v-40a3448a>3.5 Webpack-dev-server</a></li><li class="level-3" data-v-40a3448a><a href="/docs/react/%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E6%90%AD%E5%BB%BAReact%E9%A1%B9%E7%9B%AE.html#_3-6-加载样式" class="sidebar-link" data-v-40a3448a>3.6 加载样式</a></li><li class="level-3" data-v-40a3448a><a href="/docs/react/%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E6%90%AD%E5%BB%BAReact%E9%A1%B9%E7%9B%AE.html#_3-7-加载静态资源" class="sidebar-link" data-v-40a3448a>3.7 加载静态资源</a></li><li class="level-3" data-v-40a3448a><a href="/docs/react/%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E6%90%AD%E5%BB%BAReact%E9%A1%B9%E7%9B%AE.html#_3-8-第三方库" class="sidebar-link" data-v-40a3448a>3.8 第三方库</a></li><li class="level-3" data-v-40a3448a><a href="/docs/react/%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E6%90%AD%E5%BB%BAReact%E9%A1%B9%E7%9B%AE.html#_3-9-其他" class="sidebar-link" data-v-40a3448a>3.9 其他</a></li><li class="level-2" data-v-40a3448a><a href="/docs/react/%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E6%90%AD%E5%BB%BAReact%E9%A1%B9%E7%9B%AE.html#_4-优化" class="sidebar-link" data-v-40a3448a>4. 优化</a></li><li class="level-3" data-v-40a3448a><a href="/docs/react/%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E6%90%AD%E5%BB%BAReact%E9%A1%B9%E7%9B%AE.html#_4-1-模式" class="sidebar-link" data-v-40a3448a>4.1 模式</a></li><li class="level-3" data-v-40a3448a><a href="/docs/react/%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E6%90%AD%E5%BB%BAReact%E9%A1%B9%E7%9B%AE.html#_4-2-代码压缩" class="sidebar-link" data-v-40a3448a>4.2 代码压缩</a></li><li class="level-3" data-v-40a3448a><a href="/docs/react/%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E6%90%AD%E5%BB%BAReact%E9%A1%B9%E7%9B%AE.html#_4-3-tree-sharing" class="sidebar-link" data-v-40a3448a>4.3 Tree Sharing</a></li><li class="level-3" data-v-40a3448a><a href="/docs/react/%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E6%90%AD%E5%BB%BAReact%E9%A1%B9%E7%9B%AE.html#_4-4-提取公共代码" class="sidebar-link" data-v-40a3448a>4.4 提取公共代码</a></li><li class="level-3" data-v-40a3448a><a href="/docs/react/%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E6%90%AD%E5%BB%BAReact%E9%A1%B9%E7%9B%AE.html#_4-5-优化loader配置" class="sidebar-link" data-v-40a3448a>4.5 优化loader配置</a></li><li class="level-3" data-v-40a3448a><a href="/docs/react/%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E6%90%AD%E5%BB%BAReact%E9%A1%B9%E7%9B%AE.html#_4-6-resolve" class="sidebar-link" data-v-40a3448a>4.6 Resolve</a></li><li class="level-3" data-v-40a3448a><a href="/docs/react/%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E6%90%AD%E5%BB%BAReact%E9%A1%B9%E7%9B%AE.html#_4-7-hash" class="sidebar-link" data-v-40a3448a>4.7 Hash</a></li><li class="level-3" data-v-40a3448a><a href="/docs/react/%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E6%90%AD%E5%BB%BAReact%E9%A1%B9%E7%9B%AE.html#_4-8-遗留" class="sidebar-link" data-v-40a3448a>4.8 遗留</a></li></ul></main> <!----></div></div></div></div><div class="global-ui"><div class="back-to-ceiling" style="right:1rem;bottom:6rem;width:2.5rem;height:2.5rem;border-radius:.25rem;line-height:2.5rem;display:none;" data-v-c6073ba8 data-v-c6073ba8><svg t="1574745035067" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5404" class="icon" data-v-c6073ba8><path d="M526.60727968 10.90185116a27.675 27.675 0 0 0-29.21455937 0c-131.36607665 82.28402758-218.69155461 228.01873535-218.69155402 394.07834331a462.20625001 462.20625001 0 0 0 5.36959153 69.94390903c1.00431239 6.55289093-0.34802892 13.13561351-3.76865779 18.80351572-32.63518765 54.11355614-51.75690182 118.55860487-51.7569018 187.94566865a371.06718723 371.06718723 0 0 0 11.50484808 91.98906777c6.53300375 25.50556257 41.68394495 28.14064038 52.69160883 4.22606766 17.37162448-37.73630017 42.14135425-72.50938081 72.80769204-103.21549295 2.18761121 3.04276886 4.15646224 6.24463696 6.40373557 9.22774369a1871.4375 1871.4375 0 0 0 140.04691725 5.34970492 1866.36093723 1866.36093723 0 0 0 140.04691723-5.34970492c2.24727335-2.98310674 4.21612437-6.18497483 6.3937923-9.2178004 30.66633723 30.70611158 55.4360664 65.4791928 72.80769147 103.21549355 11.00766384 23.91457269 46.15860503 21.27949489 52.69160879-4.22606768a371.15156223 371.15156223 0 0 0 11.514792-91.99901164c0-69.36717486-19.13165746-133.82216804-51.75690182-187.92578088-3.42062944-5.66790279-4.76302748-12.26056868-3.76865837-18.80351632a462.20625001 462.20625001 0 0 0 5.36959269-69.943909c-0.00994388-166.08943902-87.32547796-311.81420293-218.6915546-394.09823051zM605.93803103 357.87693858a93.93749974 93.93749974 0 1 1-187.89594924 6.1e-7 93.93749974 93.93749974 0 0 1 187.89594924-6.1e-7z" p-id="5405" data-v-c6073ba8></path><path d="M429.50777625 765.63860547C429.50777625 803.39355007 466.44236686 1000.39046097 512.00932183 1000.39046097c45.56695499 0 82.4922232-197.00623328 82.5015456-234.7518555 0-37.75494459-36.9345906-68.35043303-82.4922232-68.34111062-45.57627738-0.00932239-82.52019037 30.59548842-82.51086798 68.34111062z" p-id="5406" data-v-c6073ba8></path></svg></div><!----><div id="live2d-widget" class="live2d-widget-container" style="position:fixed;right:168px;bottom:0px;width:135px;height:300px;z-index:99999;opacity:1;pointer-events:none;"><canvas id="live2d_canvas" width="135" height="300" class="live2d_canvas" style="position:absolute;left:0px;top:0px;width:135px;height:300px;"></canvas></div></div></div>
    <script src="/assets/js/app.7fe1ffb5.js" defer></script><script src="/assets/js/3.788743b5.js" defer></script><script src="/assets/js/1.29b2523c.js" defer></script><script src="/assets/js/72.126c91c0.js" defer></script><script src="/assets/js/14.37268bde.js" defer></script>
  </body>
</html>
